<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAHARAJA Cricket Club - QR Code</title>
    <link rel="shortcut icon" href="./src/img/favicon.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <link rel="stylesheet" href="qr.css">
</head>

<body>
    <div id="nav">
        <a href="./index.html">
            <img class="logo-img" src="./src/img/logo.png" alt="Logo">
        </a>
        <h4><a href="index.html">HOME</a></h4>
        <h4><a href="join.html">MEMBERSHIP</a></h4>
    </div>

    <div class="container">
        <h1>Welcome to the MAHARAJA Cricket Club!</h1>
        <p>Your QR code is ready</p>

        <!-- QR Code image element -->
        <div class="qrcode">
            <img id="qrImage" alt="QR Code" />
        </div>

        <!-- Download QR Code button -->
        <a id="downloadLink" href="#" download="membership_qr_code.png">
            <button class="download-btn">Download QR Code</button>
        </a>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Generate a unique token (current timestamp)
            const uniqueToken = Date.now().toString();  // Convert it to a string
            console.log("Unique Token Generated:", uniqueToken); // Log the unique token

            // Check if QRCode library is loaded
            if (typeof QRCode === "undefined") {
                console.error("QRCode library is not loaded.");
                return;
            }

            // Try generating the QR code
            try {
                QRCode.toDataURL(uniqueToken, function (error, url) {
                    if (error) {
                        console.error("Error generating QR code:", error);
                        return;
                    }

                    // Log the generated URL for debugging
                    console.log('Generated QR Code URL:', url);

                    // Set the QR code image source to the generated data URL
                    const qrImageElement = document.getElementById('qrImage');
                    if (qrImageElement) {
                        qrImageElement.src = url;  // Update the image src with the QR code URL
                    }

                    // Set the download link href to the same data URL for the download button
                    const downloadLink = document.getElementById('downloadLink');
                    if (downloadLink) {
                        downloadLink.href = url;  // Set the download link href to the data URL
                    }
                });
            } catch (e) {
                console.error("Error during QR code generation:", e);
            }
        });
    </script>

</body>

</html>
